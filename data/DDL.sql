SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL';

DROP SCHEMA IF EXISTS intelliQ;
CREATE SCHEMA intelliQ;
USE intelliQ;

CREATE TABLE Admin (
    Aid INT UNSIGNED NOT NULL,
    Last_Name VARCHAR(50) NOT NULL,
    First_Name VARCHAR(50) NOT NULL,
    Telephone INT UNSIGNED NOT NULL,
    PRIMARY KEY (Aid)
);

CREATE TABLE Questionnaire (
    QuestionnaireID VARCHAR(50) NOT NULL,
    Questionnaire_Title VARCHAR(50) NOT NULL,
    Aid INT UNSIGNED NOT NULL,
    PRIMARY KEY(QuestionnaireID)
);

CREATE TABLE Keywords (
    Keyword VARCHAR(20) NOT NULL,
    PRIMARY KEY (Keyword)
);

CREATE TABLE User (
    UserID INT UNSIGNED NOT NULL,
    Username VARCHAR(50) NOT NULL,
    Email  VARCHAR(50) NOT NULL,
    PRIMARY KEY (UserID)
);

CREATE TABLE Question (
    Question_ID VARCHAR(50) NOT NULL,
    Qtext VARCHAR(255) NOT NULL,
    Qrequired VARCHAR(50) NOT NULL,
    Qtype VARCHAR(10) NOT NULL,
    QuestionaireID VARCHAR(50) NOT NULL, 
    PRIMARY KEY(Question_ID)
);

CREATE TABLE Options (
    Opt_ID VARCHAR(50) NOT NULL,
    Opt_Text VARCHAR(255) NOT NULL,
    PRIMARY KEY (Opt_ID)
);

CREATE TABLE Sesion (
    Session_ID VARCHAR(50) NOT NULL,
    QuestionnaireID VARCHAR(50) NOT NULL,
    UserString VARCHAR(10) NOT NULL,
    PRIMARY KEY (Session_ID),
    FOREIGN KEY (QuestionnaireID) REFERENCES Questionnaire(QuestionnaireID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE Questionnaire_Keywords (
    QuestionnaireQuestionnaireID VARCHAR(50) NOT NULL,
    KeywordsKeyword VARCHAR(20) NOT NULL,
    PRIMARY KEY (QuestionnaireQuestionnaireID, KeywordsKeyword),
    FOREIGN KEY (QuestionnaireQuestionnaireID) REFERENCES Questionnaire(QuestionnaireID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (KeywordsKeyword) REFERENCES Keywords(Keyword) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE Questions_Options (
    QuestionID VARCHAR(50) NOT NULL,
    OptID VARCHAR(50) NOT NULL,
    Next_Q VARCHAR(50) NOT NULL,
    PRIMARY KEY (QuestionID, OptID),
    FOREIGN KEY (QuestionID) REFERENCES Question(Question_ID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (OptID) REFERENCES Options(Opt_ID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (Next_Q) REFERENCES Question(Question_ID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE Session_Questions_Options (
    Q_ID VARCHAR(50) NOT NULL,
    S_ID VARCHAR(50) NOT NULL,
    O_ID VARCHAR(50) NOT NULL,
    PRIMARY KEY (Q_ID, S_ID, O_ID),
    FOREIGN KEY (Q_ID) REFERENCES Question(Question_ID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (S_ID) REFERENCES Sesion(Session_ID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (O_ID) REFERENCES Options(Opt_ID) ON DELETE RESTRICT ON UPDATE CASCADE
);

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;