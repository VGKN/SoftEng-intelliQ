SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL';

DROP SCHEMA IF EXISTS intelliQ;
CREATE SCHEMA intelliQ;
USE intelliQ;

CREATE TABLE Admin (
    Aid INT UNSIGNED NOT NULL,
    Last_Name VARCHAR(50) NOT NULL,
    First_Name VARCHAR(50) NOT NULL,
    Telephone INT UNSIGNED NOT NULL,
    PRIMARY KEY (Aid)
);

CREATE TABLE Questionnaire (
    QuestionnaireID INT UNSIGNED NOT NULL,
    Questionnaire_Title VARCHAR(50) NOT NULL,
    Aid INT UNSIGNED NOT NULL,
    PRIMARY KEY(QuestionnaireID)
);

CREATE TABLE Keywords (
    Keyword VARCHAR(20) NOT NULL,
    PRIMARY KEY (Keyword)
);

CREATE TABLE User (
    UserID INT UNSIGNED NOT NULL,
    Username VARCHAR(50) NOT NULL,
    Email  VARCHAR(50) NOT NULL,
    PRIMARY KEY (UserID)
);

CREATE TABLE Question (
    Question_ID INT UNSIGNED NOT NULL,
    Qtext VARCHAR(255) NOT NULL,
    Qrequired BINARY(1) NOT NULL,
    Qtype VARCHAR(10),
    QuestionaireID INT UNSIGNED NOT NULL, 
    PRIMARY KEY(Question_ID)
);

CREATE TABLE Options (
    OptID INT UNSIGNED NOT NULL,
    Opt_Text VARCHAR(255) NOT NULL,
    PRIMARY KEY (OptID)
);

CREATE TABLE Session (
    SessionID VARCHAR(50) NOT NULL,
    QuestionnaireID INT UNSIGNED NOT NULL,
    UserString VARCHAR(10) NOT NULL,
    PRIMARY KEY (SessionID),
    FOREIGN KEY (QuestionnaireID) REFERENCES Questionnaire(QuestionnaireID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE Questionnaire_Keywords (
    QuestionnaireQuestionnaireID INT UNSIGNED NOT NULL,
    KeywordsKeyword VARCHAR(20) NOT NULL,
    PRIMARY KEY (QuestionnaireQuestionnaireID, KeywordsKeyword),
    FOREIGN KEY (QuestionnaireQuestionnaireID) REFERENCES Questionnaire(QuestionnaireID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (KeywordsKeyword) REFERENCES Keywords(Keyword) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE Questions_Options (
    QuestionID INT UNSIGNED NOT NULL,
    OptID INT UNSIGNED NOT NULL,
    Next_Q INT UNSIGNED NOT NULL,
    PRIMARY KEY (QuestionID, OptID),
    FOREIGN KEY (QuestionID) REFERENCES Question(QuestionID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (OptID) REFERENCES Options(OptID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (Next_Q) REFERENCES Question(QuestionID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE Session_Questions_Options (
    SessionID INT UNSIGNED NOT NULL,
    QuestionID INT UNSIGNED NOT NULL,
    OptID INT UNSIGNED NOT NULL,
    PRIMARY KEY (SessionID, QuestionID, OptID),
    FOREIGN KEY (QuestionID) REFERENCES Question(QuestionID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (SessionID) REFERENCES Session(SessionID) ON DELETE RESTRICT ON UPDATE CASCADE,
    FOREIGN KEY (OptID) REFERENCES Options(OptID) ON DELETE RESTRICT ON UPDATE CASCADE
);

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;